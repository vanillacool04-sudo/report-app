<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Theme -->
    <link rel="stylesheet" href="/static/theme.css">

    <style>
        body {
            background: linear-gradient(
                180deg,
                #eaf2ff 0%,
                #f4f8ff 45%,
                #ffffff 100%
            );
            min-height: 100vh;
            color: #1f2937;
        }

        body::before {
            content: "";
            position: fixed;
            inset: 0;
            background-image:
                radial-gradient(rgba(108,168,255,0.12) 1px, transparent 1px);
            background-size: 28px 28px;
            pointer-events: none;
            z-index: -1;
        }

        .container {
            max-width: 1200px;
            padding-top: 32px;
            padding-bottom: 48px;
        }

        /* select ‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏∏‡πà‡∏° */
        .dept-select {
            min-width: 220px;
            border-radius: 999px;
            padding: 8px 16px;
            font-weight: 600;
            border: 1px solid rgba(108,168,255,0.5);
            background-color: #ffffff;
        }

        .dept-select:focus {
            outline: none;
            border-color: #6ca8ff;
            box-shadow: 0 0 0 3px rgba(108,168,255,0.25);
        }
    </style>
</head>

<body>

<div class="container">

   <!-- HEADER -->
    <div class="report-header">
        <div>
            <h2>üì¶ {{ page_title }}</h2>
            <div class="text-muted">
                ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
            </div>
        </div>

        <div class="d-flex gap-2">

            <!-- form ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï (‡∏Ñ‡∏£‡∏≠‡∏ö‡πÅ‡∏Ñ‡πà‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß) -->
            <form method="post"
                action="/assets/reset-check-status"
                onsubmit="return confirmReset();"
                class="d-inline">
                <button type="submit" class="btn btn-warning">
                    üîÑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà
                </button>
            </form>

            <a href="/assets/import" class="btn btn-primary">
                ‚¨ÜÔ∏è Import Excel
            </a>

            <a href="{{ url_for('add_asset') }}" class="btn btn-success">
                ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå
            </a>

            <a href="/" class="btn btn-secondary">
                ‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
            </a>

        </div>
    </div>


    {% if request.path != '/assets/search' %}
        <!-- FILTER -->
        <div class="section-box">
            <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
                <h5 class="mb-0">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå</h5>

                <select class="dept-select"
                        onchange="changeDept(this.value)">
                    <option value=""
                            {% if not current_dept %}selected{% endif %}>
                        ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô
                    </option>

                    {% for short, full in dept_map.items() %}
                    <option value="{{ short }}"
                            {% if current_dept == short %}selected{% endif %}>
                        {{ full }}
                    </option>
                    {% endfor %}
                </select>

                <select class="dept-select"
                        onchange="changeStatus(this.value)">
                    <option value="">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                    <option value="‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô" {% if status == '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' %}selected{% endif %}>
                        ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                    </option>
                    <option value="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö"
                            {% if status == '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö' %}selected{% endif %}>
                        ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
                    </option>
                    <option value="‡πÄ‡∏•‡∏¥‡∏Å‡πÉ‡∏ä‡πâ" {% if status == '‡πÄ‡∏•‡∏¥‡∏Å‡πÉ‡∏ä‡πâ' %}selected{% endif %}>
                        ‡πÄ‡∏•‡∏¥‡∏Å‡πÉ‡∏ä‡πâ
                    </option>
                </select>
            </div>
        </div>
        {% endif %}


   <!-- SEARCH ASSET / SERIAL -->
    <div class="section-box mt-3">
        <h5 class="mb-3">üîé ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå / ‡∏£‡∏∏‡πà‡∏ô / Serial / ‡∏ú‡∏π‡πâ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏á</h5>

        <form method="get" action="/assets/search">
            <div class="row g-2 align-items-end">

                <div class="col-md-3">
                    <label class="form-label">‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå</label>
                    <input type="text"
                        name="asset_no"
                        class="form-control"
                        placeholder="‡πÄ‡∏ä‡πà‡∏ô 7440-00x-000x-xxx/xx"
                        value="{{ request.args.get('asset_no','') }}">
                </div>

                <!-- ‚≠ê ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ -->
                <div class="col-md-2">
                    <label class="form-label">‡∏£‡∏∏‡πà‡∏ô</label>
                    <input type="text"
                        name="model"
                        class="form-control"
                        placeholder="‡πÄ‡∏ä‡πà‡∏ô Dell / HP / ThinkPad"
                        value="{{ request.args.get('model','') }}">
                </div>


                <div class="col-md-2">
                    <label class="form-label">Serial</label>
                    <input type="text"
                        name="serial"
                        class="form-control"
                        placeholder="Serial Number"
                        value="{{ request.args.get('serial','') }}">
                </div>

                <div class="col-md-2">
                    <label class="form-label">‡∏ú‡∏π‡πâ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏á</label>
                    <input type="text"
                        name="owner"
                        class="form-control"
                        placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠"
                        value="{{ request.args.get('owner','') }}">
                </div>

                
                <div class="col-md-3">
                    <button type="submit"
                            class="btn btn-primary px-5">
                        üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                    </button>
                </div>

            </div>
        </form>

    </div>

    {% if request.path == '/assets/search' %}
    <div class="mb-3 text-center">
        <a href="/assets" class="btn btn-outline-secondary">
            üîô ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        </a>
    </div>
    {% endif %}


   

    <!-- TABLE -->
    <div class="section-box">
        <div class="table-responsive-horizontal">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th width="60">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                        <th>‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå</th>
                        <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                        <th>‡∏£‡∏∏‡πà‡∏ô</th>
                        <th>Serial</th>
                        <th>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</th>
                        <th>‡∏ú‡∏π‡πâ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏á</th>
                        <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</th>
                        <th class="text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                        <th class="text-center" width="90">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                <tbody>
                {% if assets %}
                    {% for a in assets %}
                    <tr>
                        <td class="text-center">{{ loop.index }}</td>
                        <td>{{ a[1] }}</td>
                        <td>{{ a[2] }}</td>
                        <td>{{ a[3] }}</td>
                        <td>{{ a[4] }}</td>
                        <td>{{ a[5] }}</td>
                        <td>{{ a[6] }}</td>
                        <td>{{ a[7] }}</td>

                        <td class="text-center">
                            {% if a[8] == '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö' %}
                                <span class="badge-status badge-danger">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏£‡∏ß‡∏à</span>
                            {% elif a[8] == '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' %}
                                <span class="badge-status badge-active">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
                            {% else %}
                                <span class="badge-status badge-secondary">‡πÄ‡∏•‡∏¥‡∏Å‡πÉ‡∏ä‡πâ</span>
                            {% endif %}
                        </td>

                        <td class="text-center">
                            <a href="/assets/edit/{{ a[0] }}" class="btn btn-sm btn-outline-warning">‚úèÔ∏è</a>
                            <a href="/assets/delete/{{ a[0] }}"
                               class="btn btn-sm btn-outline-danger"
                               onclick="return confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏ô‡∏µ‡πâ?');">
                               üóë
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="10" class="text-center text-muted py-4">
                            ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå
                        </td>
                    </tr>
                {% endif %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- FOOTER -->
    <div class="mt-4 d-flex justify-content-center gap-2 flex-wrap">
        <a href="/assets/export-excel?{% if current_dept %}dept={{ current_dept }}&{% endif %}{% if status %}status={{ status }}{% endif %}"
        class="btn btn-success">
            üì• Export Excel
        </a>

        <a href="/" class="btn btn-secondary">
            ‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
        </a>
    </div>

</div>

            <script>
            function confirmReset() {
                const first = confirm(
                    "‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö\n" +
                    "‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà\n\n" +
                    "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ '‡πÄ‡∏•‡∏¥‡∏Å‡πÉ‡∏ä‡πâ' ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô\n\n" +
                    "‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?"
                );

                if (!first) return false;

                const second = prompt(
                    "‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ RESET ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà"
                );

                return second === "RESET";
            }
            </script>

            

            <script>
            function changeDept(dept) {
                // üîí ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤ search ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ redirect
                if (window.location.pathname === "/assets/search") {
                    return;
                }

                const params = new URLSearchParams(window.location.search);

                if (dept) {
                    params.set("dept", dept);
                } else {
                    params.delete("dept");
                }

                window.location = "/assets?" + params.toString();
            }

            function changeStatus(status) {
                // üîí ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤ search ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ redirect
                if (window.location.pathname === "/assets/search") {
                    return;
                }

                const params = new URLSearchParams(window.location.search);

                if (status) {
                    params.set("status", status);
                } else {
                    params.delete("status");
                }

                window.location = "/assets?" + params.toString();
            }
            </script>





</body>

</html>
