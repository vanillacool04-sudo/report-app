<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</title>

    <!-- Google Font (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô summary) -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Theme ‡∏Å‡∏•‡∏≤‡∏á -->
    <link rel="stylesheet" href="/static/theme.css">

    <style>
        body {
            font-family: "Sarabun", system-ui, sans-serif;
            background-color: #eef2f7;
        }
        .chart-wrapper {
            width: 100%;
            height: 280px;   /* ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô report_summary */
        }
        .chart-wrapper {
            height: 260px;
        }
    </style>
</head>

<body>

<div class="container mt-5 mb-5">
    <div class="card shadow">

        <!-- HEADER -->
        <div class="card-header">
            <h4 class="mb-0">üìä ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</h4>
        </div>

        <div class="card-body">

            <!-- ===== FILTER (‡πÅ‡∏û‡∏ó‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö summary) ===== -->
            <form method="get" class="row g-2 mb-3 align-items-center">

                <div class="col-md-3">
                    <input type="date"
                           name="date_from"
                           class="form-control"
                           value="{{ date_from }}">
                </div>

                <div class="col-md-3">
                    <input type="date"
                           name="date_to"
                           class="form-control"
                           value="{{ date_to }}">
                </div>

                <div class="col-md-2">
                    <select name="person1" class="form-select" required>
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô</option>
                        <option value="‡∏ô‡∏ô‡∏ó‡πå‡∏ì‡∏û‡∏±‡∏í‡∏ô‡πå ‡∏Å‡∏±‡∏ô‡∏ï‡∏û‡∏•‡∏≠‡∏¥‡∏ó‡∏ò‡∏¥"
                            {% if person1=="‡∏ô‡∏ô‡∏ó‡πå‡∏ì‡∏û‡∏±‡∏í‡∏ô‡πå ‡∏Å‡∏±‡∏ô‡∏ï‡∏û‡∏•‡∏≠‡∏¥‡∏ó‡∏ò‡∏¥" %}selected{% endif %}>
                            ‡∏ô‡∏ô‡∏ó‡πå‡∏ì‡∏û‡∏±‡∏í‡∏ô‡πå ‡∏Å‡∏±‡∏ô‡∏ï‡∏û‡∏•‡∏≠‡∏¥‡∏ó‡∏ò‡∏¥
                        </option>
                        <option value="‡∏ä‡∏±‡∏¢‡∏ß‡∏∏‡∏í‡∏¥ ‡∏®‡∏£‡∏µ‡πÅ‡∏Å‡πâ‡∏ß"
                            {% if person1=="‡∏ä‡∏±‡∏¢‡∏ß‡∏∏‡∏í‡∏¥ ‡∏®‡∏£‡∏µ‡πÅ‡∏Å‡πâ‡∏ß" %}selected{% endif %}>
                            ‡∏ä‡∏±‡∏¢‡∏ß‡∏∏‡∏í‡∏¥ ‡∏®‡∏£‡∏µ‡πÅ‡∏Å‡πâ‡∏ß
                        </option>
                    </select>
                </div>

                <div class="col-md-2">
                    <select name="person2" class="form-select" required>
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô</option>
                        <option value="‡∏ô‡∏ô‡∏ó‡πå‡∏ì‡∏û‡∏±‡∏í‡∏ô‡πå ‡∏Å‡∏±‡∏ô‡∏ï‡∏û‡∏•‡∏≠‡∏¥‡∏ó‡∏ò‡∏¥"
                            {% if person2=="‡∏ô‡∏ô‡∏ó‡πå‡∏ì‡∏û‡∏±‡∏í‡∏ô‡πå ‡∏Å‡∏±‡∏ô‡∏ï‡∏û‡∏•‡∏≠‡∏¥‡∏ó‡∏ò‡∏¥" %}selected{% endif %}>
                            ‡∏ô‡∏ô‡∏ó‡πå‡∏ì‡∏û‡∏±‡∏í‡∏ô‡πå ‡∏Å‡∏±‡∏ô‡∏ï‡∏û‡∏•‡∏≠‡∏¥‡∏ó‡∏ò‡∏¥
                        </option>
                        <option value="‡∏ä‡∏±‡∏¢‡∏ß‡∏∏‡∏í‡∏¥ ‡∏®‡∏£‡∏µ‡πÅ‡∏Å‡πâ‡∏ß"
                            {% if person2=="‡∏ä‡∏±‡∏¢‡∏ß‡∏∏‡∏í‡∏¥ ‡∏®‡∏£‡∏µ‡πÅ‡∏Å‡πâ‡∏ß" %}selected{% endif %}>
                            ‡∏ä‡∏±‡∏¢‡∏ß‡∏∏‡∏í‡∏¥ ‡∏®‡∏£‡∏µ‡πÅ‡∏Å‡πâ‡∏ß
                        </option>
                    </select>
                </div>

                <div class="col-md-2 d-grid">
                    <button class="btn btn-primary">
                        üîç ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö
                    </button>
                </div>

            </form>

            <!-- ===== GRAPH CARD ===== -->
            <div class="card shadow-sm mb-4">
                <div class="card-header">üìà ‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏á‡∏≤‡∏ô</div>
                <div class="card-body">
                    <div class="chart-wrapper">
                        <canvas id="compareChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- ===== TABLE ===== -->
            <div class="table-responsive">
                <table class="table table-hover text-center align-middle">
                    <thead>
                        <tr>
                            <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                            {% for l in data.labels %}
                                <th>{{ l }}</th>
                            {% endfor %}
                            <th>‡∏£‡∏ß‡∏°</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- person 1 -->
                        <tr>
                            <td class="fw-bold">
                                <a href="/list?staff={{ person1 }}&date_from={{ date_from }}&date_to={{ date_to }}">
                                    {{ person1 }}
                                </a>
                            </td>

                            {% for v in data.person1 %}
                                <td>{{ v }}</td>
                            {% endfor %}

                            <td class="fw-bold">{{ total1 }}</td>
                        </tr>

                        <!-- person 2 -->
                        <tr>
                            <td class="fw-bold">
                                <a href="/list?staff={{ person2 }}&date_from={{ date_from }}&date_to={{ date_to }}">
                                    {{ person2 }}
                                </a>
                            </td>

                            {% for v in data.person2 %}
                                <td>{{ v }}</td>
                            {% endfor %}

                            <td class="fw-bold">{{ total2 }}</td>
                        </tr>

                        <!-- diff -->
                        <tr class="table-secondary">
                            <td class="fw-bold">‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á</td>

                            {% for d in diff %}
                                <td class="fw-bold
                                    {% if d > 0 %}text-success
                                    {% elif d < 0 %}text-danger
                                    {% else %}text-muted{% endif %}">
                                    {{ d }}
                                </td>
                            {% endfor %}

                            <td class="fw-bold">{{ diff_total }}</td>
                        </tr>
                    </tbody>

                </table>
            </div>

            <!-- BACK -->
            <div class="text-center mt-4">
                <a href="/" class="btn btn-outline-secondary"
                style="border-radius: 12px;">‚¨Ö ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
                <a href="/report-summary"
                class="btn btn-primary px-4 py-2 rounded-pill shadow-sm">
                    üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ
                </a>
            </div>

        </div>
    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const ctx = document
    .getElementById('compareChart')
    .getContext('2d');

new Chart(ctx, {
    type: 'bar',
    data: {
        labels: {{ data.labels | tojson }},
        datasets: [
            {
                label: "{{ person1 }}",
                data: {{ data.person1 | tojson }},
                backgroundColor: '#3b82f6',

                borderColor: '#eeeeee',   // üëà ‡∏™‡∏µ‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏≠‡∏ö‡πÅ‡∏ó‡πà‡∏á
                borderWidth: 1,

                barThickness: 14,
                borderRadius: 6,
                borderSkipped: false
            },
            {
                label: "{{ person2 }}",
                data: {{ data.person2 | tojson }},
                backgroundColor: '#ef4444',

                borderColor: '#ffffff',   // üëà ‡∏™‡∏µ‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏≠‡∏ö‡πÅ‡∏ó‡πà‡∏á
                borderWidth: 1,

                barThickness: 14,
                borderRadius: 6,
                borderSkipped: false
            }
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,   // ‚≠ê ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
        indexAxis: 'y',
        plugins: {
            legend: { position: 'bottom' }
        },
        scales: {
            x: {
                beginAtZero: true,
                ticks: { stepSize: 1 },
                grid: { color: 'rgba(148,163,184,0.3)' }
            },
            y: {
                grid: { display: false }
            }
        }
    }
});
</script>

</body>
</html>
