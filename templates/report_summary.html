<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô</title>

    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/theme.css">
    <style>
        body {
            background-color: #eef2f7;
            font-family: "Sarabun", system-ui, -apple-system, "Segoe UI", sans-serif;
        }
        .card-header {
            background-color: #1f3a5f;
            color: white;
        }
        table th {
            background-color: #1f3a5f;
            color: white;
        }
        table th, table td {
            text-align: center !important;
            vertical-align: middle !important;
        }
        .summary-card h6 {
            font-size: 14px;
        }
        .summary-card h2 {
            font-size: 28px;
            margin: 0;
        }

        /* ===== REPORT SUMMARY ‚Äì SAME TONE ===== */

        /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏Å */
        .card,
        .section-box {
            background: linear-gradient(
                180deg,
                #ffffff 0%,
                #f9fbff 100%
            );
            border-radius: 18px;
            border: 1px solid rgba(108, 168, 255, 0.18);
            box-shadow: 0 18px 40px rgba(59, 130, 246, 0.12);
        }

        /* ‡∏´‡∏±‡∏ß‡∏Å‡∏≤‡∏£‡πå‡∏î */
        .card-header {
            background: transparent;
            color: #1e3a8a;
            font-weight: 600;
            border-bottom: none;
        }

        /* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
        .table {
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 14px;
            overflow: hidden;
            background: #ffffff;
        }

        /* ‡πÄ‡∏™‡πâ‡∏ô‡∏Ñ‡∏±‡πà‡∏ô‡πÅ‡∏ô‡∏ß‡∏Ç‡∏ß‡∏≤‡∏á */
        .table tbody tr:not(:last-child) td,
        .table tbody tr:not(:last-child) th {
            border-bottom: 1px solid rgba(148, 163, 184, 0.28);
        }

        /* hover ‡πÄ‡∏ö‡∏≤ ‡πÜ */
        .table tbody tr:hover td,
        .table tbody tr:hover th {
            background-color: rgba(108, 168, 255, 0.05);
        }

        /* ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏™‡∏£‡∏∏‡∏õ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) */
        .summary-number {
            font-size: 1.6rem;
            font-weight: 700;
            color: #2563eb;
        }

        /* ===== SUMMARY CHART SIZE ===== */
        .chart-wrapper {
            width: 100%;        /* ‚≠ê ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç */
            max-width: none;    /* ‚≠ê ‡πÄ‡∏≠‡∏≤‡∏≠‡∏≠‡∏Å */
            height: 320px;      /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á */
        }

        
    </style>
</head>

<body>

<div class="container mt-1 mb-5">
    <div class="card shadow">

        <div class="card-header">
            <h4 class="mb-0">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô</h4>
        </div>

        <div class="card-body">

            <!-- ================= ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ================= -->
            <form method="get" class="row g-2 mb-3 align-items-center">

                <div class="col-md-2">
                    <input type="date" name="date_from" class="form-control" value="{{ date_from }}">
                </div>

                <div class="col-md-2">
                    <input type="date" name="date_to" class="form-control" value="{{ date_to }}">
                </div>

                <div class="col-md-2 d-grid">
                    <button class="btn btn-primary">üîç ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
                </div>

                <div class="col-md-2 d-grid">
                    <a href="/" class="btn btn-secondary">‚¨Ö ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
                </div>

                {% if is_search %}
                <div class="col-md-2 d-grid">
                    <a href="/work-compare" class="btn btn-outline-primary">
                        üìä ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏á‡∏≤‡∏ô
                    </a>
                </div>
                {% endif %}

                {% if is_search %}
                <div class="col-md-2 d-grid">
                    <a href="/export-excel?date_from={{ date_from }}&date_to={{ date_to }}"
                    class="btn btn-success">
                    üì§ Export Excel
                    </a>
                </div>
                {% endif %}

        

            </form>

            <!-- ================= ‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ================= -->
            {% if is_search %}
                <p class="text-muted text-center mb-4">
                    ‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: {{ date_from }} ‡∏ñ‡∏∂‡∏á {{ date_to }}
                </p>
            {% else %}
                <p class="text-muted text-center mb-4">
                    üîç ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î ‚Äú‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‚Äù
                </p>
            {% endif %}

            {% if is_search %}

            <!-- ================= ‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç ================= -->
            <div class="row mb-4 text-center justify-content-center">
                <div class="col-md-2">
                    <div class="card shadow-sm summary-card">
                        <div class="card-body">
                            <h6>‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h6>
                            <h2 class="text-dark fw-bold" style="font-size:28px;">{{ total }}</h2>
                        </div>
                    </div>
                </div>

                <div class="col-md-2">
                    <div class="card shadow-sm summary-card">
                        <div class="card-body">
                            <h6>Software</h6>
                            <h2 class="text-primary">{{ software }}</h2>
                        </div>
                    </div>
                </div>

                <div class="col-md-2">
                    <div class="card shadow-sm summary-card">
                        <div class="card-body">
                            <h6>Hardware</h6>
                            <h2 class="text-danger">{{ hardware }}</h2>
                        </div>
                    </div>
                </div>

                <div class="col-md-2">
                    <div class="card shadow-sm summary-card">
                        <div class="card-body">
                            <h6>Network</h6>
                            <h2 class="text-success">{{ network }}</h2>
                        </div>
                    </div>
                </div>

                <div class="col-md-2">
                    <div class="card shadow-sm summary-card">
                        <div class="card-body">
                            <h6>Other</h6>
                            <h2 class="text-secondary">{{ other }}</h2>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ================= ‡∏Å‡∏£‡∏≤‡∏ü ================= -->
            <div class="card shadow mb-4">
                <div class="card-header">üìà ‡∏Å‡∏£‡∏≤‡∏ü‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</div>
                <div class="card-body">
                    <div class="chart-wrapper">
                        <canvas id="summaryChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- ================= ‡∏ï‡∏≤‡∏£‡∏≤‡∏á ================= -->
            <div class="table-responsive-horizontal">
            <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                            <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà-‡πÄ‡∏ß‡∏•‡∏≤</th>
                            <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</th>
                            <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô</th>
                            <th>‡∏õ‡∏±‡∏ç‡∏´‡∏≤</th>
                            <th>‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</th>
                            <th>‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for r in rows %}
                        <tr>
                            <td class="fw-bold">{{ loop.index }}</td>
                            <td>{{ format_date_th(r[0]) if r[0] else "-" }}</td>
                            <td>{{ r[1] }}</td>
                            <td>
                                <span class="badge
                                    {% if r[2]=='Software' %}bg-primary
                                    {% elif r[2]=='Hardware' %}bg-danger
                                    {% elif r[2]=='Network' %}bg-success
                                    {% else %}bg-secondary{% endif %}">
                                    {{ r[2] }}
                                </span>
                            </td>
                            <td>{{ r[3] }}</td>
                            <td>{{ r[4] }}</td>
                            <td>{{ r[5] }}</td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="7" class="text-muted">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                
                </div>
            </div>
            <!-- ================= ‡∏õ‡∏∏‡πà‡∏°‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ================= -->
            <div class="d-flex justify-content-center gap-3 mb-4">
                <a
                    href="/report-monthly-summary?date_from={{ date_from }}&date_to={{ date_to }}"
                    class="btn btn-outline-primary px-4"
                >
                    üìã ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                </a>

                <a
                    href="/admin/export-db"
                    class="btn btn-outline-danger px-4"
                    onclick="return confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏Ñ‡∏≠‡∏±‡∏û‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?')">
                    üì¶ Backup DB
                </a>
            </div>



            {% endif %}
        </div>
    </div>
</div>
{% if is_search %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const chartData = {{ chart_data | tojson }};
const ctx = document.getElementById('summaryChart').getContext('2d');

/* ‡∏™‡∏£‡πâ‡∏≤‡∏á gradient ‡πÉ‡∏´‡πâ‡πÅ‡∏ó‡πà‡∏á‡∏î‡∏π‡∏°‡∏µ‡∏°‡∏¥‡∏ï‡∏¥ */
function makeGradient(top, bottom) {
    const g = ctx.createLinearGradient(0, 0, 0, 260);
    g.addColorStop(0, top);
    g.addColorStop(1, bottom);
    return g;
}

new Chart(ctx, {
    type: 'bar',
    data: {
        labels: chartData.labels,
        datasets: [
            {
                label: 'Software',
                data: chartData.software,
                barThickness: 18,
                maxBarThickness: 22,
                borderRadius: 6,
                borderSkipped: false,
                backgroundColor: makeGradient('#e0f2fe', '#60a5fa'), // ‚úÖ ‡πÉ‡∏™‡πà ,
                borderColor: '#52bbf0',
                borderWidth: 1
            },

            {
                label: 'Hardware',
                data: chartData.hardware,
                barThickness: 18,
                maxBarThickness: 22,
                borderRadius: 6,
                borderSkipped: false,
                backgroundColor: makeGradient('#fee2e2', '#ef4444'), // ‚úÖ
                borderColor: '#b91c1c',
                borderWidth: 1
            },

           {
                label: 'Network',
                data: chartData.network,
                barThickness: 18,
                maxBarThickness: 22,
                borderRadius: 6,
                borderSkipped: false,
                backgroundColor: makeGradient('#dcfce7', '#398e58'), // ‚úÖ
                borderColor: '#13522a',
                borderWidth: 1
            },

            {
                label: 'Other',
                data: chartData.other,
                barThickness: 18,
                maxBarThickness: 22,
                borderRadius: 6,
                borderSkipped: false,
                backgroundColor: makeGradient('#e5e7eb', '#6b7280'), // ‚úÖ
                borderColor: '#374151',
                borderWidth: 1
            }

        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'bottom'
            }
        },
        scales: {
            x: {
                grid: { display: false },
                stacked: false,
                ticks: {
                    maxRotation: 0,
                    autoSkip: false
                }
            },
            y: {
                beginAtZero: true,
                grid: { color: 'rgba(148,163,184,0.3)' },
                ticks: { stepSize: 1 }
            }
        }
    }
});
</script>

{% endif %}

</body>
</html>
