<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <title>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</title>

    <!-- Bootstrap (‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Theme ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤ (‡πÇ‡∏ó‡∏ô / ‡∏™‡∏µ / ‡πÄ‡∏á‡∏≤) -->
    <link rel="stylesheet" href="/static/theme.css">
    <style>
        /* === LIST PAGE ‚Äì SaaS STYLE (‡∏à‡∏≤‡∏Å report) === */

        /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á */
        body {
            background: linear-gradient(
                180deg,
                #eaf2ff 0%,
                #f4f8ff 45%,
                #ffffff 100%
            );
        }

        /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏Å */
        .card {
            background: linear-gradient(
                180deg,
                #ffffff 0%,
                #f9fbff 100%
            );
            border-radius: 18px;
            border: 1px solid rgba(108,168,255,0.18);
            box-shadow: 0 18px 40px rgba(59,130,246,0.12);
        }

        /* ‡∏´‡∏±‡∏ß‡∏Å‡∏≤‡∏£‡πå‡∏î */
        .card-header {
            background: transparent;
            font-weight: 600;
            color: #1e3a8a;
        }

        /* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
        .table th {
            background: #f1f6ff;
            color: #1e3a8a;
            font-weight: 600;
        }

        .table td {
            vertical-align: middle;
        }

        /* ‡∏õ‡∏∏‡πà‡∏° action */
        .btn-view {
            background: #6ca8ff;
            color: #fff;
            border-radius: 10px;
        }

        .btn-view:hover {
            background: #4f8cff;
        }

        /* ===== CENTER TABLE HEAD & BODY ===== */
            .table th,
            .table td {
                text-align: center;
                vertical-align: middle;
            }

            .table tbody tr {
                background: #ffffff;
                box-shadow: 0 6px 16px rgba(59,130,246,0.10);
                border-radius: 12px;
            }

            .table {
                border-collapse: separate;
                border-spacing: 0;
                border-radius: 14px;
                box-shadow: 0 10px 24px rgba(59,130,246,0.12);
            }

            .table thead th:first-child {
                border-top-left-radius: 14px;
            }

            .table thead th:last-child {
                border-top-right-radius: 14px;
            }

            /* ===== FIX TABLE TEXT ON iPad ===== */
            @media (min-width: 768px) and (max-width: 1024px) {

                /* ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà */
                .table th,
                .table td {
                    white-space: nowrap;
                    font-size: 14px;
                    padding: 10px 8px;
                }

                /* ‡∏ï‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏î‡πâ‡∏ß‡∏¢ ... */
                .table td {
                    overflow: hidden;
                    text-overflow: ellipsis;
                }
                .table td:nth-child(6) {
                    white-space: normal;   /* ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ */
                    max-width: 260px;
                    text-align: left;
                }

                /* ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÅ‡∏Ñ‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏© */
                .table td:nth-child(1) { max-width: 90px; }   /* ‡πÄ‡∏•‡∏Ç‡∏á‡∏≤‡∏ô */
                .table td:nth-child(2) { max-width: 120px; }  /* ‡∏ß‡∏±‡∏ô-‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô */
                .table td:nth-child(6) { max-width: 110px; }  /* ‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå */
                .table td:nth-child(7) { max-width: 120px; }  /* ‡∏ß‡∏±‡∏ô-‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô */

                .action-col {
                    white-space: nowrap;
                    overflow: visible;
                    min-width: 120px;
                }
            }

                .table-responsive {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
    </style>
</head>

<body>
<div class="container mt-2 mb-5">

    <!-- ================= CARD 1 : HEADER / CONTEXT ================= -->
    <div class="card shadow mb-3">
        <div class="card-body py-3">

            {% if staff %}
            <div class="alert alert-info py-2 mb-2">
                ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á <strong>{{ staff }}</strong>
                {% if date_from and date_to %}
                    ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà {{ date_from }} ‚Äì {{ date_to }}
                {% endif %}
                <a href="/list" class="ms-2">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</a>
            </div>
            {% endif %}

            <h4 class="mb-0">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</h4>

        </div>
    </div>

    <!-- ================= CARD 2 : SEARCH / FILTER ================= -->
    <div class="card shadow-sm mb-4">
        <div class="card-body py-3">

            <form method="get">

                <!-- ‡πÅ‡∏ñ‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö ‡πÜ -->
                <div class="row g-2 align-items-center">

                    <div class="col-lg-4">
                        <input type="text"
                            name="q"
                            class="form-control"
                            placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏•‡∏Ç‡∏á‡∏≤‡∏ô / ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô / ‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á / ‡∏õ‡∏±‡∏ç‡∏´‡∏≤"
                            value="{{ keyword }}">
                    </div>

                    <div class="col-lg-2">
                        <select name="job_type" class="form-select">
                            <option value="">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô</option>
                            <option value="Software" {% if job_type == 'Software' %}selected{% endif %}>Software</option>
                            <option value="Hardware" {% if job_type == 'Hardware' %}selected{% endif %}>Hardware</option>
                            <option value="Network" {% if job_type == 'Network' %}selected{% endif %}>Network</option>
                            <option value="Other" {% if job_type == 'Other' %}selected{% endif %}>Other</option>
                        </select>
                    </div>

                    <div class="col-lg-2">
                        <select name="staff" class="form-select">
                            <option value="">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</option>
                            <option value="‡∏ô‡∏ô‡∏ó‡πå‡∏ì‡∏û‡∏±‡∏í‡∏ô‡πå ‡∏Å‡∏±‡∏ô‡∏ï‡∏û‡∏•‡∏≠‡∏¥‡∏ó‡∏ò‡∏¥"
                                {% if staff=="‡∏ô‡∏ô‡∏ó‡πå‡∏ì‡∏û‡∏±‡∏í‡∏ô‡πå ‡∏Å‡∏±‡∏ô‡∏ï‡∏û‡∏•‡∏≠‡∏¥‡∏ó‡∏ò‡∏¥" %}selected{% endif %}>
                                ‡∏ô‡∏ô‡∏ó‡πå‡∏ì‡∏û‡∏±‡∏í‡∏ô‡πå ‡∏Å‡∏±‡∏ô‡∏ï‡∏û‡∏•‡∏≠‡∏¥‡∏ó‡∏ò‡∏¥
                            </option>
                            <option value="‡∏ä‡∏±‡∏¢‡∏ß‡∏∏‡∏í‡∏¥ ‡∏®‡∏£‡∏µ‡πÅ‡∏Å‡πâ‡∏ß"
                                {% if staff=="‡∏ä‡∏±‡∏¢‡∏ß‡∏∏‡∏í‡∏¥ ‡∏®‡∏£‡∏µ‡πÅ‡∏Å‡πâ‡∏ß" %}selected{% endif %}>
                                ‡∏ä‡∏±‡∏¢‡∏ß‡∏∏‡∏í‡∏¥ ‡∏®‡∏£‡∏µ‡πÅ‡∏Å‡πâ‡∏ß
                            </option>
                        </select>
                    </div>

                    <div class="col-lg-2">
                        <input type="date"
                            name="date_from"
                            class="form-control"
                            value="{{ date_from }}">
                    </div>

                    <div class="col-lg-2">
                        <input type="date"
                            name="date_to"
                            class="form-control"
                            value="{{ date_to }}">
                    </div>

                </div>

                <!-- ‡∏õ‡∏∏‡πà‡∏° -->
                <div class="d-flex justify-content-end gap-2 mt-2">
                    <button type="submit" class="btn btn-primary btn-sm px-4">
                        ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                    </button>
                    <a href="/list" class="btn btn-outline-secondary btn-sm px-4">
                        ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï
                    </a>
                </div>

            </form>

        </div>
    </div>




    <!-- ================= CARD 3 : TABLE ================= -->
    <div class="card shadow">
        <div class="card-body pt-3">

            <div class="table-responsive">

                <!-- üîΩ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡πÄ‡∏ü‡∏ï (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ logic) -->
                <table class="table table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>‡πÄ‡∏•‡∏Ç‡∏á‡∏≤‡∏ô</th>
                            <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                            <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</th>
                            <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                            <th>‡∏õ‡∏±‡∏ç‡∏´‡∏≤</th>
                            <th>‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ</th>
                            <th>‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á</th>
                            <th class="text-center">‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for r in reports %}
                        <tr>
                            <td>{{ r[1] }}</td>
                            <td>{{ format_date_th(r[2]) }}</td>
                            <td>{{ get_department_full(r[3]) }}</td>
                            <td>{{ r[4] }}</td>
                            <td>{{ r[5] }}</td>
                            <td>{{ r[6] }}</td>
                            <td>{{ r[7] }}</td>
                            <!-- ‚úÖ ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô -->
                            <td class="text-center action-col">
                                <!-- ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î -->
                                <a href="/view/{{ r[0] }}"
                                class="btn btn-sm btn-view me-1"
                                title="‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">
                                    üëÅ
                                </a>

                                <!-- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç -->
                                <a href="/edit/{{ r[0] }}"
                                class="btn btn-sm btn-outline-primary me-1"
                                title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">
                                    ‚úèÔ∏è
                                </a>

                                <!-- ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å -->
                                <a href="/copy/{{ r[0] }}"
                                class="btn btn-sm btn-outline-secondary me-1"
                                title="‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏á‡∏≤‡∏ô">
                                    üìÑ
                                </a>

                                <!-- ‡∏•‡∏ö -->
                                <form action="/delete/{{ r[0] }}"
                                    method="post"
                                    style="display:inline;"
                                    onsubmit="return confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ?');">
                                    <button type="submit"
                                            class="btn btn-sm btn-outline-danger"
                                            title="‡∏•‡∏ö">
                                        üóë
                                    </button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}

                    </tbody>
                </table>

            </div>

        </div>
    </div>

    <!-- ================= FOOTER ================= -->
    <div class="d-flex justify-content-center gap-3 my-4">

        <a href="/" class="btn btn-secondary px-4 py-2">
            ‚¨Ö ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å
        </a>

        <a href="/report-summary"
        class="btn btn-primary px-5 py-2 rounded-pill shadow-sm">
            üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ
        </a>

    </div>

</div>


<!-- ===== SUCCESS MODAL ===== -->
<div class="modal fade" id="successModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-4">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h5>
        <button type="button"
                class="btn-close btn-close-white"
                data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body text-center fs-5">
        <p id="successMessage">‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</p>
      </div>
      <div class="modal-footer justify-content-center">
        <button class="btn btn-success px-4"
                data-bs-dismiss="modal">‡∏ï‡∏Å‡∏•‡∏á</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

{% if request.args.get('success') %}
<script>
  const modal = new bootstrap.Modal(
      document.getElementById('successModal')
  );
  const msg = document.getElementById('successMessage');

  {% if request.args.get('success') == 'save' %}
    msg.innerText = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß";
  {% elif request.args.get('success') == 'edit' %}
    msg.innerText = "‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß";
  {% elif request.args.get('success') == 'delete' %}
    msg.innerText = "‡∏•‡∏ö‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß";
  {% endif %}

  modal.show();
</script>
{% endif %}



</body>
</html>
